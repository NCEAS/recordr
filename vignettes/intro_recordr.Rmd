---
title: "intro_recordr"
author: "Peter Slaughter"
date: "October 3, 2015"
output: html_document
---
#Overview

The *recordr* package collects information about R script executions (aka runs). The captured information 
includes the files that were read and written when R script execute, and details of the execution
environment, such as the operating system version, R packages loaded, etc.

The recorded information for a script constitutes data provenance for the data products and analysis
outputs (graphs, .csv files, etc) generated by a script execution, and provides information to describe how a data product was created.

#Using recordr

The *record()* method that takes an R script as an argument and sources it.

The following example runs a sample script that is included with the *recordr* package:

```{r,warning=F,message=F}
library(recordr)
rc <- new("Recordr")
runid <- record(rc, system.file("extdata/EmCoverage.R", package="recordr") , tag="first recordr run")
```
It is not necessary to modify an R script in order to use *record*.

Information about the script execution is stored in the *recordr* cache directory and can be searched and viewed,  then individual runs can be uploaded to a  data repository.

Script runs that have been recorded can be listed using the *listRuns()* method. The
listing can be filtered by the tag value given to the run, the run start time, run end time, the text of error messages for a run and by a sequence number, which is an integer
value assigned to each run to assist in easily specifying a particular run for listing, 
viewing or publishing.

In this example, all runs with a tag containing the string "first" are listed. Because
recordr has only run once in this demo, only one run is listed:
```{r,warning=F,message=F}
library(recordr)
rc <- new("Recordr")
listRuns(rc, tag="first")
```
If no search parameters are specified to *listRuns*, then all recorded runs are listed. 

*recordr* can also collect information during an R console session using the
startRecord() method to begin recording and endRecord() to stop information capture. 

```
rc <- new("Recordr")
startRecord(rc, tag="first console run")

df <- read.csv(file = system.file("./extdata/coverages_2001-2010.csv", package="recordr"))
endocladia_coverage <- df[df$final_classification=="endocladia muricata",]
myDir <- tempdir()
csvOutFile <- sprintf("%s/Endocladia_muricata.csv", myDir)
write.csv(endocladia_coverage, file = csvOutFile)

endRecord(rc)
```

The history of all statements typed during this recorded console session is
saved in the *recordr* cache and will be included in the datapackage uploaded 
to a data repository when publishRun() is called.

More detailed information can be retrieved and viewed for a run or set of runs
using the *viewRuns()* method.

```{r,warning=F,message=F}
library(recordr)
rc <- new("Recordr")
viewRuns(rc, tag="console run")
```
#Publishing a run

The *recordr* package uses the R package *dataone* to assist in packaging and publishing data
generated by a script execution. The *dataone* package uses a configuration file to assist
in controlling where and how a script execution is run. The first file that *record()* is
run, an initial copy of the *dataone* configuration script is copied to the directory
'~/.dataone/sessionConfig.R'.

A metadata file is created for each run when record() is called that contains an
entry for each data object generated by a script run. This metadata file is
generated using the file "~/.recordr/package_metadata_template.R". This template file
is created the first time *record()* is run. 

```
myMeta <- getMetadata(rc, seq=1)
writeLines("/tmp/my.eml", myMeta)
# Edit the metdata
putMetadata(rc, seq=1, "/tmp/my.eml", asText=F)

```
library(recordr)
rc <- new("Recordr")
publishRun(rc)
```
